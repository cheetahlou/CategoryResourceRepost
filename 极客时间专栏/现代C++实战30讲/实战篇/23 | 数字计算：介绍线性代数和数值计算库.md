<audio id="audio" title="23 | æ•°å­—è®¡ç®—ï¼šä»‹ç»çº¿æ€§ä»£æ•°å’Œæ•°å€¼è®¡ç®—åº“" controls="" preload="none"><source id="mp3" src="https://static001.geekbang.org/resource/audio/8b/b1/8bcc899b1dfec29c3d6b90f47a522db1.mp3"></audio>

ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚

ç§‘å­¦è®¡ç®—åœ¨ä»Šå¤©å·²ç»å®Œå…¨å¯ä»¥ä½¿ç”¨ C++ äº†ã€‚æˆ‘ä¸æ˜¯ä»äº‹ç§‘å­¦è®¡ç®—è¿™ä¸€é¢†åŸŸçš„å·¥ä½œçš„ï¼Œä¸è¿‡ï¼Œåœ¨å·¥ä½œä¸­ä¹Ÿå¤šå¤šå°‘å°‘æ¥è§¦åˆ°äº†ä¸€äº›è®¡ç®—ç›¸å…³çš„åº“ã€‚ä»Šå¤©ï¼Œæˆ‘å°±ç»™ä½ ä»‹ç»å‡ ä¸ªæœ‰ç”¨çš„è®¡ç®—åº“ã€‚

## Armadillo

è¯´åˆ°è®¡ç®—ï¼Œä½ å¯èƒ½é¦–å…ˆä¼šæƒ³åˆ°çŸ©é˜µã€çŸ¢é‡è¿™äº›ä¸œè¥¿å§ï¼Ÿè¿™äº›è®¡ç®—ï¼Œç¡®å®å°±æ˜¯ç§‘å­¦è®¡ç®—ä¸­çš„å¸¸è§å†…å®¹äº†ã€‚è¿™äº›é¢†åŸŸçš„æ ‡å‡†ï¼Œå³æ˜¯ä¸€äº› Fortran åº“å®šä¸‹çš„ï¼Œå¦‚ï¼š

- BLAS [1]
- LAPACK [2]
- ARPACK [3]

å®ƒä»¬çš„å®ç°å€’ä¸ä¸€å®šç”¨ Fortranï¼Œå°¤å…¶æ˜¯ BLASï¼š

- OpenBLAS [4] æ˜¯ç”¨æ±‡ç¼–å’Œ C è¯­è¨€å†™çš„
- Intel MKL [5] æœ‰é’ˆå¯¹ Intel çš„ç‰¹å®š CPU æŒ‡ä»¤é›†è¿›è¡Œä¼˜åŒ–çš„æ±‡ç¼–ä»£ç 
- Mir GLAS [6] æ˜¯ç”¨ D è¯­è¨€å†™çš„

ä¸ç®¡å®ç°çš„æ–¹æ³•æ˜¯å“ªä¸€ç§ï¼Œæš´éœ²å‡ºæ¥çš„å‡½æ•°åå­—æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š

- `ddot`
- `dgemv`
- `dsyrk`
- `sgemm`
- â€¦â€¦

è¿™ä¸ªæ¥å£çš„å”¯ä¸€å¥½å¤„ï¼Œåº”è¯¥å°±æ˜¯ï¼Œå®ƒæ˜¯è·¨è¯­è¨€å¹¶ä¸”è·¨å®ç°çš„ğŸ˜…ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨è¿™äº›å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥åˆ‡æ¢ä¸åŒçš„å®ç°ï¼Œè€Œä¸éœ€è¦æ›´æ”¹ä»£ç ã€‚å”¯ä¸€éœ€è¦ä¿®æ”¹çš„ï¼Œé€šå¸¸å°±æ˜¯é“¾æ¥åº“çš„åå­—æˆ–ä½ç½®è€Œå·²ã€‚

å‡è®¾æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªç®€å•çš„çŸ©é˜µè¿ç®—ï¼Œå¯¹ä¸€ä¸ªçŸ¢é‡è¿›è¡Œæ—‹è½¬ï¼š

$$<br>
\begin{aligned}<br>
\mathbf{P} &amp;= \begin{bmatrix} 1 \\\ 0 \end{bmatrix}\\\<br>
\mathbf{R} &amp;= \begin{bmatrix}<br>
\cos(\theta) &amp; -\sin(\theta) \\\<br>
\sin(\theta) &amp; \cos(\theta)\end{bmatrix}\\\<br>
\mathbf{P^\prime} &amp;= \mathbf{R} \cdot \mathbf{P}<br>
\end{aligned}<br>
$$

è¿™ä¹ˆä¸€ä¸ªç®€å•çš„æ“ä½œï¼Œç”¨çº¯ C æ¥å£çš„ BLAS æ¥è¡¨è¾¾ï¼Œæœ‰ç‚¹ç—›è‹¦ï¼šä½ éœ€è¦ä½¿ç”¨çš„å¤§æ¦‚æ˜¯ `dgemv_` å‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°éœ€è¦ 11 ä¸ªå‚æ•°ï¼æˆ‘æŸ¥é˜…äº†ä¸€ä¸‹èµ„æ–™ä¹‹åï¼Œä¹Ÿå°±æ”¾å¼ƒäº†ç»™ä½ å±•ç¤ºä¸€ä¸‹å¦‚ä½•è°ƒç”¨ `dgemv_` çš„ä¼å›¾ï¼Œæˆ‘ä»¬è¿˜æ˜¯è€è€å®å®åœ°çœ‹ä¸€ä¸‹åœ¨ç°ä»£ C++ é‡Œçš„å†™æ³•å§ï¼š

```
#include &lt;armadillo&gt;
#include &lt;cmath&gt;
#include &lt;iostream&gt;

using namespace std;

int main()
{
  // ä»£è¡¨ä½ç½®çš„å‘é‡
  arma::vec pos{1.0, 0.0};

  // æ—‹è½¬çŸ©é˜µ
  auto&amp; pi = arma::datum::pi;
  double angle = pi / 2;
  arma::mat rot = {
    {cos(angle), -sin(angle)},
    {sin(angle), cos(angle)}};

  cout &lt;&lt; "Current position:\n"
       &lt;&lt; pos;
  cout &lt;&lt; "Rotating "
       &lt;&lt; angle * 180 / pi
       &lt;&lt; " deg\n";

  arma::vec new_pos = rot * pos;
  cout &lt;&lt; "New position:\n"
       &lt;&lt; new_pos;
}

```

è¿™å°±æ˜¯ä½¿ç”¨ Armadillo [7] åº“æ¥å®ç°çŸ¢é‡æ—‹è½¬çš„ä»£ç ã€‚è¿™ä¸ªä»£ç ï¼ŒåŸºæœ¬å°±æ˜¯ä¸Šé¢çš„æ•°å­¦å…¬å¼çš„ä¸€ä¸€å¯¹åº”äº†ã€‚ä»£ç ç›¸å½“ç›´ç™½ï¼Œæˆ‘åªéœ€è¦ç¨ç¨è¯´æ˜ä¸€ä¸‹ï¼š

- æ‰€æœ‰çš„ Armadillo çš„ç±»å‹å’Œå‡½æ•°éƒ½å®šä¹‰åœ¨ `arma` åç©ºé—´ä¸‹ã€‚
- Armadillo åœ¨ `arma::datum` ä¸‹å®šä¹‰äº†åŒ…æ‹¬ pi å’Œ e åœ¨å†…çš„ä¸€äº›æ•°å­¦å¸¸é‡ã€‚
- `vec` æ˜¯çŸ¢é‡ç±»å‹ï¼Œ`mat` æ˜¯çŸ©é˜µç±»å‹ï¼Œè¿™ä¸¤ä¸ªç±»å‹å®é™…ä¸Šæ˜¯ `Col&lt;double&gt;` å’Œ `Mat&lt;double&gt;` çš„ç¼©å†™åˆ«åã€‚
- Armadillo æ”¯æŒä½¿ç”¨ C++11 çš„åˆ—è¡¨åˆå§‹åŒ–è¯­æ³•æ¥åˆå§‹åŒ–å¯¹è±¡ã€‚
- Armadillo æ”¯æŒä½¿ç”¨æµæ¥è¾“å‡ºå¯¹è±¡ã€‚

ä¸Šé¢ä»£ç çš„è¾“å‡ºä¸ºï¼š

> 
<p>`Current position:`<br>
`1.0000`<br>
`0`<br>
`Rotating 90 deg`<br>
`New position:`<br>
`6.1232e-17`<br>
`1.0000e+00`</p>


è¾“å‡ºé‡Œé¢çš„ `6.1232e-17` æ˜¯æµ®ç‚¹æ•°è¡¨ç¤ºä¸ç²¾ç¡®çš„åæœï¼ŒæŠŠå®ƒç†è§£æˆ 0 å°±å¯¹äº†ã€‚

æˆ‘ä»¬ä¸Šé¢å·²ç»æåˆ°äº† `vec` å®é™…ä¸Šæ˜¯ `Col&lt;double&gt;`ï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹çš„åˆ—çŸ¢é‡ã€‚è‡ªç„¶ï¼ŒArmadillo ä¹Ÿæœ‰è¡ŒçŸ¢é‡ `rowvec`ï¼ˆå³ `Row&lt;double&gt;`ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ•°å­—ç±»å‹ï¼Œå¦‚ `int`ã€ `float` å’Œ `complex&lt;float&gt;`ã€‚æ­¤å¤–ï¼Œé™¤äº†å¤§å°ä¸ç¡®å®šçš„çº¿æ€§ä»£æ•°å¯¹è±¡ä¹‹å¤–ï¼ŒArmadillo ä¹Ÿæä¾›äº†å›ºå®šå¤§å°çš„å­ç±»å‹ï¼Œå¦‚ `vec::fixed&lt;2&gt;` å’Œ `mat::fixed&lt;2, 2&gt;`ï¼›ä¸ºæ–¹ä¾¿ä½¿ç”¨ï¼Œè¿˜æä¾›äº†ä¸å°‘åˆ«åï¼Œå¦‚ `imat22` ä»£è¡¨ `Mat&lt;int&gt;::fixed&lt;2, 2&gt;` ç­‰ã€‚å›ºå®šå¤§å°çš„å¯¹è±¡ä¸éœ€è¦åŠ¨æ€å†…å­˜åˆ†é…ï¼Œä½¿ç”¨ä¸Šæœ‰ä¸€å®šçš„æ€§èƒ½ä¼˜åŠ¿ã€‚

Armadillo æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„åº“ï¼Œå®ƒçš„å¤´æ–‡ä»¶æ•°é‡è¶…è¿‡äº† 500 ä¸ªã€‚æˆ‘ä»¬ä»Šå¤©ä¸å¯èƒ½ã€ä¹Ÿä¸å¿…è¦æè¿°å®ƒçš„æ‰€æœ‰åŠŸèƒ½ï¼Œåªèƒ½ç¨ç¨éƒ¨åˆ†åˆ—ä¸¾ä¸€ä¸‹ï¼š

- é™¤äº†ç›®å‰æåˆ°çš„åˆ—çŸ¢é‡ã€è¡ŒçŸ¢é‡å’ŒçŸ©é˜µå¤–ï¼ŒArmadillo ä¹Ÿæ”¯æŒä¸‰ç»´çš„æ•°æ®ç«‹æ–¹ä½“ï¼Œ`Cube` æ¨¡æ¿ã€‚
- Armadillo æ”¯æŒç¨€ç–çŸ©é˜µï¼Œ`SpMat` æ¨¡æ¿ã€‚
- é™¤äº†æ•°å­¦ä¸Šçš„åŠ ã€å‡ã€ä¹˜è¿ç®—ï¼ŒArmadillo æ”¯æŒæŒ‰å…ƒç´ çš„ä¹˜æ³•ã€é™¤æ³•ã€ç›¸ç­‰ã€ä¸ç­‰ã€å°äºæ¯”è¾ƒç­‰ï¼ˆä½¿ç”¨ `%`ã€`/`ã€`==`ã€`!=`ã€`&lt;` ç­‰ï¼‰è¿ç®—ï¼Œç»“æœçš„å¤§å°è·Ÿå‚æ•°ç›¸åŒï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ç›¸åº”è¿ç®—çš„ç»“æœã€‚æŸäº›è¿ç®—ç¬¦å¯èƒ½ä¸å¤ªç›´è§‚ï¼Œå°¤å…¶æ˜¯ `%`ï¼ˆä¸æ˜¯å–æ¨¡ï¼‰å’Œ `==`ï¼ˆè¿”å›ä¸æ˜¯å•ä¸ªå¸ƒå°”å€¼ï¼Œè€Œæ˜¯çŸ©é˜µï¼‰ã€‚
- Armadillo æ”¯æŒå¯¹éå›ºå®šå¤§å°çš„çŸ¢é‡ã€çŸ©é˜µå’Œç«‹æ–¹ä½“ï¼Œæ”¹å˜å…¶å¤§å°ï¼ˆ`.reshape()` å’Œ `resize()`ï¼‰ã€‚
- Armadillo å¯ä»¥æ–¹ä¾¿åœ°æŒ‰è¡Œï¼ˆ`.col()`ï¼‰ã€åˆ—ï¼ˆ`.row()`ï¼‰ã€å¯¹è§’çº¿ï¼ˆ`.diag()`ï¼‰è¯»å†™çŸ©é˜µçš„å†…å®¹ï¼ŒåŒ…æ‹¬ç”¨ä¸€ä¸ªçŸ¢é‡å»æ”¹å†™çŸ©é˜µçš„å¯¹è§’çº¿ã€‚
- Armadillo å¯ä»¥æ–¹ä¾¿åœ°å¯¹çŸ©é˜µè¿›è¡Œè½¬ç½®ï¼ˆ`.t()`ï¼‰ã€æ±‚åï¼ˆ`.inv()`ï¼‰ã€‚
- Armadillo å¯ä»¥å¯¹çŸ©é˜µè¿›è¡Œç‰¹å¾åˆ†è§£ï¼ˆ`eigen_sym()`ã€`eigen_gen()` ç­‰ï¼‰ã€‚
- Armadillo æ”¯æŒå‚…ç«‹å¶å˜æ¢ï¼ˆ`fft()`ã€`fft2()` ç­‰ï¼‰ã€‚
- Armadillo æ”¯æŒå¸¸è§çš„ç»Ÿè®¡è®¡ç®—ï¼Œå¦‚å¹³å‡å€¼ã€ä¸­ä½å€¼ã€æ ‡å‡†åå·®ç­‰ï¼ˆ`mean()`ã€`median()`ã€`stddev()` ç­‰ï¼‰ã€‚
- Armadillo æ”¯æŒå¤šé¡¹å¼æ–¹ç¨‹æ±‚æ ¹ï¼ˆ`roots`ï¼‰ã€‚
- Armadillo æ”¯æŒ kâ€å¹³å‡èšç±»ï¼ˆ**k**-means clusteringï¼‰ç®—æ³•ï¼ˆ`kmeans`ï¼‰ã€‚
- ç­‰ç­‰ã€‚

å¦‚æœä½ éœ€è¦ç”¨åˆ°è¿™äº›åŠŸèƒ½ï¼Œä½ å¯ä»¥è‡ªå·±å»æŸ¥çœ‹ä¸€ä¸‹å…·ä½“çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬è¿™å„¿åªæå‡ ä¸ªä¸ç¼–ç¨‹æœ‰å…³çš„ç»†èŠ‚ã€‚

### å¯¹è±¡çš„è¾“å‡º

æˆ‘ä»¬ä¸Šé¢å·²ç»å±•ç¤ºäº†ç›´æ¥æŠŠå¯¹è±¡è¾“å‡ºåˆ°ä¸€ä¸ªæµã€‚æˆ‘ä»¬çš„å†™æ³•æ˜¯ï¼š

```
cout &lt;&lt; "Current position:\n"
     &lt;&lt; pos;

```

å®é™…ä¸ŠåŸºæœ¬ç­‰ä»·äºè°ƒç”¨ `print` æˆå‘˜å‡½æ•°ï¼š

```
pos.print("Current position:");

```

è¿™ä¸ªå†™æ³•å¯èƒ½ä¼šæ›´ç®€å•äº›ã€‚æ­¤å¤–ï¼Œåœ¨è¿™ä¸¤ç§æƒ…å†µï¼Œè¾“å‡ºçš„æ ¼å¼éƒ½æ˜¯ Armadillo è‡ªåŠ¨æ§åˆ¶çš„ã€‚å¦‚æœä½ å¸Œæœ›è‡ªå·±æ§åˆ¶çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ `raw_print` æˆå‘˜å‡½æ•°ã€‚æ¯”å¦‚ï¼Œå¯¹äºä¸Šé¢ä»£ç é‡Œå¯¹ `new_pos` çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆï¼ˆéœ€è¦åŒ…å« &lt;iomanip&gt;ï¼‰ï¼š

```
cout &lt;&lt; fixed &lt;&lt; setw(9)
     &lt;&lt; setprecision(4);
new_pos.raw_print(
  cout, "New position:");

```

è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°å¯¹æ ¼å¼ã€å®½åº¦å’Œç²¾åº¦è¿›è¡Œè®¾ç½®ï¼Œèƒ½å¾—åˆ°ï¼š

> 
<p>`New position:`<br>
`0.0000`<br>
`1.0000`</p>


è®°å¾—æˆ‘ä»¬è¯´è¿‡ `vec` æ˜¯ `Col&lt;double&gt;` çš„åˆ«åï¼Œå› æ­¤è¾“å‡ºæ˜¯å¤šè¡Œçš„ã€‚æˆ‘ä»¬è¦è¾“å‡ºæˆå•è¡Œçš„è¯ï¼Œè½¬ç½®ï¼ˆtransposeï¼‰ä¸€ä¸‹å°±å¯ä»¥äº†ï¼š

```
cout &lt;&lt; fixed &lt;&lt; setw(9)
     &lt;&lt; setprecision(4);
new_pos.t().raw_print(
  cout, "New position:");

```

è¾“å‡ºä¸ºï¼š

> 
<p>`New position:`<br>
`0.0000 1.0000`</p>


### è¡¨è¾¾å¼æ¨¡æ¿

å¦‚æœä½ å¥‡æ€ªå‰é¢ `dgemv_` ä¸ºä»€ä¹ˆæœ‰ 11 ä¸ªå‚æ•°ï¼Œè¿™é‡Œæœ‰ä¸ªæˆ‘æ²¡æœ‰æçš„ç»†èŠ‚æ˜¯ï¼Œå®ƒæ‰§è¡Œçš„å®é™…ä¸Šæ˜¯ä¸ªå¤åˆæ“ä½œï¼š

$$<br>
\mathbf{y} \gets \alpha\mathbf{A}\cdot\mathbf{x} + \beta\mathbf{y}<br>
$$

å¦‚æœä½ åªæ˜¯ç®€å•åœ°åšä¹˜æ³•çš„è¯ï¼Œå°±ç›¸å½“äº $\alpha$ ä¸º 1ã€$\beta$ ä¸º 0 çš„ç‰¹æ®Šæƒ…å†µã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœä½ çœŸçš„å†™äº†ç±»ä¼¼äºä¸Šé¢è¿™æ ·çš„å…¬å¼çš„è¯ï¼Œç¼–è¯‘å™¨å’Œçº¿æ€§ä»£æ•°åº“èƒ½ä¸èƒ½è½¬æˆåˆé€‚çš„è°ƒç”¨ã€è€Œæ²¡æœ‰é¢å¤–çš„å¼€é”€å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼Œè‡³å°‘åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¯ä»¥çš„ã€‚ç§˜è¯€å°±æ˜¯è¡¨è¾¾å¼æ¨¡æ¿ï¼ˆexpression templateï¼‰[8]ã€‚

é‚£ä»€ä¹ˆæ˜¯è¡¨è¾¾å¼æ¨¡æ¿å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå›è¿‡å»çœ‹æˆ‘ä¸Šé¢çš„ä¾‹å­ã€‚æœ‰æ²¡æœ‰æ³¨æ„åˆ°æˆ‘å†™çš„æ˜¯ï¼š

```
arma::vec new_pos = rot * pos;

```

è€Œæ²¡æœ‰ä½¿ç”¨ `auto` æ¥å£°æ˜ï¼Ÿ

å…¶ä¸­éƒ¨åˆ†çš„åŸå› æ˜¯ï¼Œ`rot * pos` çš„ç±»å‹å¹¶ä¸æ˜¯ `vec`ï¼Œè€Œæ˜¯ï¼š

```
const Glue&lt;Mat&lt;double&gt;, Col&lt;double&gt;, glue_times&gt;

```

æ¢å¥è¯è¯´ï¼Œç»“æœæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè€Œå¹¶æ²¡æœ‰å®é™…è¿›è¡Œè®¡ç®—ã€‚å¦‚æœæˆ‘ç”¨ `auto` çš„è¯ï¼Œè¡Œä¸ºä¸Šä¼¼ä¹ä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œä½†æˆ‘æ¯æ¬¡è¾“å‡ºè¿™ä¸ªç»“æœæ—¶ï¼Œéƒ½ä¼šé‡æ–°è¿›è¡Œä¸€æ¬¡çŸ©é˜µçš„ä¹˜æ³•ï¼è€Œæˆ‘ç”¨ `arma::vec` æ¥æ”¶çš„è¯ï¼Œæ„é€ æ—¶å°±ç›´æ¥è¿›è¡Œäº†è®¡ç®—ï¼Œå­˜å‚¨äº†è¡¨è¾¾å¼çš„ç»“æœã€‚

ä¸Šé¢çš„ç®€å•ä¾‹å­ä¸èƒ½å®é™…è§¦å‘å¯¹ `dgemv_` çš„è°ƒç”¨ï¼Œæˆ‘ç”¨ä¸‹é¢çš„ä»£ç å®é™…éªŒè¯å‡ºäº†è¡¨è¾¾å¼æ¨¡æ¿äº§ç”Ÿçš„ä¼˜åŒ–ï¼ˆ`fill::randu` è¡¨ç¤ºå¯¹çŸ¢é‡å’ŒçŸ©é˜µçš„å†…å®¹è¿›è¡Œéšæœºå¡«å……ï¼‰ï¼š

```
#include &lt;armadillo&gt;
#include &lt;iostream&gt;

using namespace std;
using namespace arma;

int main()
{
  vec x(8, fill::randu);
  mat r(8, 8, fill::randu);
  vec result = 2.5 * r * x;
  cout &lt;&lt; result;
}

```

èµ‹å€¼è¯­å¥å³è¾¹çš„ç±»å‹æ˜¯ï¼š

```
const Glue&lt;eOp&lt;Mat&lt;double&gt;,
               eop_scalar_times&gt;,
           Col&lt;double&gt;, glue_times&gt;

```

å½“ä½¿ç”¨è¿™ä¸ªè¡¨è¾¾å¼æ„é€  `vec` æ—¶ï¼Œå°±ä¼šå®é™…å‘ç”Ÿå¯¹ `dgemv_` çš„è°ƒç”¨ã€‚æˆ‘ä¹Ÿç¡®å®è·Ÿè¸ªåˆ°äº†ï¼Œåœ¨å°†è¦è°ƒç”¨ `dgemv_` æ—¶ï¼Œæ ‡é‡å€¼ 2.5 ç¡®å®åœ¨å‚æ•° `alpha` æŒ‡å‘çš„ä½ç½®ä¸Šï¼ˆè¿™ä¸ªæ¥å£çš„å‚æ•°éƒ½æ˜¯æŒ‡é’ˆï¼‰ã€‚

ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹åˆ°ï¼Œè¡¨è¾¾å¼æ¨¡æ¿æ˜¯æŠŠåŒåˆƒå‰‘ï¼šæ—¢å¯ä»¥æé«˜ä»£ç çš„æ€§èƒ½ï¼Œåˆèƒ½å¢åŠ ä»£ç è¢«è¯¯ç”¨çš„å¯èƒ½æ€§ã€‚åœ¨å¯èƒ½ç”¨åˆ°è¡¨è¾¾å¼æ¨¡æ¿çš„åœ°æ–¹ï¼Œä½ éœ€è¦æ³¨æ„è¿™äº›é—®é¢˜ã€‚

### å¹³å°ç»†èŠ‚

Armadillo çš„æ–‡æ¡£é‡Œè¯´æ˜äº†å¦‚ä½•ä»æºä»£ç è¿›è¡Œå®‰è£…ï¼Œä½†åœ¨ Linux å’Œ macOS ä¸‹é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…å¯èƒ½æ˜¯æ›´å¿«çš„æ–¹å¼ã€‚åœ¨ CentOS ä¸‹å¯ä½¿ç”¨ `sudo yum install armadillo-devel`ï¼Œåœ¨ macOS ä¸‹å¯ä½¿ç”¨ `brew install armadillo`ã€‚ä½¿ç”¨åŒ…ç®¡ç†å™¨ä¸€èˆ¬ä¹Ÿä¼šåŒæ—¶å®‰è£…å¸¸è§çš„ä¾èµ–è½¯ä»¶ï¼Œå¦‚ ARPACK å’Œ OpenBLASã€‚

åœ¨ Windows ä¸Šï¼ŒArmadillo çš„å®‰è£…åŒ…é‡Œè‡ªå¸¦äº†ä¸€ä¸ªåŸºæœ¬ç‰ˆæœ¬çš„ 64 ä½ BLAS å’Œ LAPACK åº“ã€‚å¦‚æœéœ€è¦æ›´é«˜æ€§èƒ½æˆ– 32 ä½ç‰ˆæœ¬çš„è¯ï¼Œå°±éœ€è¦è‡ªå·±å¦å¤–å»å®‰è£…äº†ã€‚é™¤éä½ åªæ˜¯åšä¸€äº›éå¸¸ç®€å•çš„çº¿æ€§ä»£æ•°è®¡ç®—ï¼ˆå°±åƒæˆ‘ä»Šå¤©çš„ä¾‹å­ï¼‰ï¼Œé‚£ç›´æ¥å‘Šè¯‰ Armadillo ä¸è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ä¹Ÿè¡Œã€‚

> 
`cl /EHsc /DARMA_DONT_USE_BLAS /DARMA_DONT_USE_LAPACK â€¦`


## Boost.Multiprecision

ä¼—æ‰€å‘¨çŸ¥ï¼ŒC å’Œ C++ï¼ˆç”šè‡³æ¨è€Œå¹¿ä¹‹åˆ°å¤§éƒ¨åˆ†çš„å¸¸ç”¨ç¼–ç¨‹è¯­è¨€ï¼‰é‡Œçš„æ•°å€¼ç±»å‹æ˜¯æœ‰ç²¾åº¦é™åˆ¶çš„ã€‚æ¯”å¦‚ï¼Œä¸Šä¸€è®²çš„ä»£ç é‡Œæˆ‘ä»¬å°±ç”¨åˆ°äº† `INT_MIN`ï¼Œæœ€å°çš„æ•´æ•°ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨ç›®å‰è¿™äº›ç±»å‹æ˜¯å¤Ÿç”¨çš„ï¼ˆæœ€é«˜ä¸€èˆ¬æ˜¯ 64 ä½æ•´æ•°å’Œ 80 ä½æµ®ç‚¹æ•°ï¼‰ã€‚ä½†ä¹Ÿæœ‰å¾ˆå¤šæƒ…å†µï¼Œè¿™äº›æ ‡å‡†çš„ç±»å‹è¿œè¿œä¸èƒ½æ»¡è¶³éœ€è¦ã€‚è¿™æ—¶ä½ å°±éœ€è¦ä¸€ä¸ªé«˜ç²¾åº¦çš„æ•°å€¼ç±»å‹äº†ã€‚

æœ‰ä¸€æ¬¡æˆ‘éœ€è¦æ‰¾ä¸€ä¸ªé«˜ç²¾åº¦æ•´æ•°ç±»å‹å’Œè®¡ç®—åº“ï¼Œæœ€åæ‰¾åˆ°çš„å°±æ˜¯ Boost.Multiprecision [9]ã€‚å®ƒåŸºæœ¬æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œä»¥åŠä¸€èˆ¬æ„ä¹‰ä¸Šå¯¹åº“çš„æœŸæœ›ï¼š

- æ­£ç¡®å®ç°æˆ‘éœ€è¦çš„åŠŸèƒ½
- æ¥å£ç¬¦åˆç›´è§‰ã€æ˜“ç”¨
- æœ‰è‰¯å¥½çš„æ€§èƒ½

æ­£ç¡®å®ç°åŠŸèƒ½è¿™ç‚¹æˆ‘å°±ä¸å¤šè®²äº†ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬å‡ºå‘ç‚¹ï¼Œæ²¡æœ‰å¤ªå¤šå¯è®¨è®ºçš„åœ°æ–¹ã€‚åœ¨æˆ‘ä¸Šæ¬¡çš„éœ€æ±‚é‡Œï¼Œå¯¹æ€§èƒ½å…¶å®ä¹Ÿæ²¡æœ‰å¾ˆé«˜çš„è¦æ±‚ã€‚è®©æˆ‘å¯¹ Boost.Multiprecision æ»¡æ„çš„ä¸»è¦åŸå› ï¼Œå°±æ˜¯å®ƒçš„æ¥å£äº†ã€‚

### æ¥å£æ˜“ç”¨æ€§

æˆ‘åœ¨[[ç¬¬ 12 è®²]](https://time.geekbang.org/column/article/179363) æåˆ°äº† CLNã€‚å®ƒå¯¹æˆ‘æ¥è®²å°±æ˜¯ä¸ªåé¢æ•™æã€‚å®ƒçš„æ•´æ•°ç±»å‹ä¸ä»…ä¸æä¾› `%` è¿ç®—ç¬¦ï¼Œå±…ç„¶è¿˜ä¸æä¾› `/` è¿ç®—ç¬¦ï¼å®ƒå¼ºè¿«ç”¨æˆ·åœ¨ä¸‹é¢ä¸¤ä¸ªæ–¹æ¡ˆä¸­åšå‡ºé€‰æ‹©ï¼š

- ä½¿ç”¨ `truncate2` å‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªå•†æ•°å’Œä½™æ•°
- ä½¿ç”¨ `exquo` å‡½æ•°ï¼Œå½“ä¸”ä»…å½“å¯ä»¥æ•´é™¤çš„æ—¶å€™

ä¸ç®¡ä½œè€…çš„è®¾è®¡åŸåˆ™æ˜¯ä»€ä¹ˆï¼Œè¿™ç®€ç›´å°±æ˜¯æ˜“ç”¨æ€§æ–¹é¢çš„ç¾éš¾äº†â€”â€”ä¸ä»…è¿™äº›å‡½æ•°è¦æŸ¥æ–‡æ¡£æ‰èƒ½çŸ¥æ™“ï¼Œè€Œä¸”æœ‰çš„åœ°æ–¹æˆ‘çœŸçš„åªéœ€è¦ç®€å•çš„é™¤æ³•å‘€â€¦â€¦

å“¦ï¼Œå¯¹äº†ï¼Œå®ƒåœ¨ Windows ç¼–è¯‘è¿˜å¾ˆä¸æ–¹ä¾¿ï¼Œè€Œæˆ‘é‚£æ—¶ç”¨çš„æ­£æ˜¯ Windowsã€‚

Boost.Multiprecision çš„æƒ…å†µåˆ™æ°æ°ç›¸åï¼Œè®©æˆ‘å½“å³å¤§ä¸ºæ»¡æ„ï¼š

- ä½¿ç”¨åŸºæœ¬çš„ `cpp_int` å¯¹è±¡ä¸éœ€è¦é¢„å…ˆç¼–è¯‘åº“ï¼Œåªéœ€è¦ Boost çš„å¤´æ–‡ä»¶å’Œä¸€ä¸ªå¥½çš„ç¼–è¯‘å™¨ã€‚
- å¸¸ç”¨è¿ç®—ç¬¦ `+`ã€`-`ã€`*`ã€`/`ã€`%` ä¸€ä¸ªä¸ç¼ºï¼Œå…¨éƒ¨éƒ½æœ‰ã€‚
- å¯ä»¥è‡ªç„¶åœ°é€šè¿‡æ•´æ•°å’Œå­—ç¬¦ä¸²æ¥è¿›è¡Œæ„é€ ã€‚
- æä¾›äº†ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡æ¥é«˜æ•ˆåœ°è¿›è¡Œåˆå§‹åŒ–ã€‚
- åœ¨ä½¿ç”¨ IO æµæ—¶ï¼Œè¾“å…¥è¾“å‡ºæ—¢å¯ä»¥ä½¿ç”¨åè¿›åˆ¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `hex` æ¥åˆ‡æ¢åˆ°åå…­è¿›åˆ¶ã€‚

ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å®ƒçš„åŸºæœ¬åŠŸèƒ½ï¼š

```
#include &lt;iomanip&gt;
#include &lt;iostream&gt;
#include &lt;boost/multiprecision/cpp_int.hpp&gt;

using namespace std;

int main()
{
  using namespace boost::
    multiprecision::literals;
  using boost::multiprecision::
    cpp_int;

  cpp_int a =
    0x123456789abcdef0_cppi;
  cpp_int b = 16;
  cpp_int c{"0400"};
  cpp_int result = a * b / c;
  cout &lt;&lt; hex &lt;&lt; result &lt;&lt; endl;
  cout &lt;&lt; dec &lt;&lt; result &lt;&lt; endl;
}

```

è¾“å‡ºæ˜¯ï¼š

> 
<p>`123456789abcdef`<br>
`81985529216486895`</p>


æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ`cpp_int` å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å­—é¢é‡ï¼ˆåç¼€ `_cppi`ï¼›åªèƒ½åå…­è¿›åˆ¶ï¼‰æ¥åˆå§‹åŒ–ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªæ™®é€šæ•´æ•°æ¥åˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥åˆå§‹åŒ–ï¼ˆå¹¶å¯ä»¥ä½¿ç”¨ `0x` å’Œ `0` å‰ç¼€æ¥é€‰æ‹©åå…­è¿›åˆ¶å’Œå…«è¿›åˆ¶ï¼‰ã€‚æ‹¿å®ƒå¯ä»¥æ­£å¸¸åœ°è¿›è¡ŒåŠ å‡ä¹˜é™¤æ“ä½œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ IO æµæ¥è¾“å…¥è¾“å‡ºã€‚

### æ€§èƒ½

Boost.Multiprecision ä½¿ç”¨äº†è¡¨è¾¾å¼æ¨¡æ¿å’Œ C++11 çš„ç§»åŠ¨æ¥é¿å…ä¸å¿…è¦çš„æ‹·è´ã€‚åè€…å½“ç„¶æ˜¯ä»¶å¥½äº‹ï¼Œè€Œå‰è€…æ›¾ç»å‘äº†æˆ‘ä¸€ä¸‹â€”â€”æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨ Boost.Multiprecision æ—¶éå¸¸å›°æƒ‘ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨ `half(n - 1)` è°ƒç”¨ä¸‹é¢çš„ç®€å•å‡½æ•°å±…ç„¶ä¼šç¼–è¯‘ä¸è¿‡ï¼š

```
template &lt;typename N&gt;
inline N half(N n)
{
  return n / 2;
}

```

æˆ‘çš„æ„å›¾å½“ç„¶æ˜¯ `N` åº”å½“è¢«æ¨å¯¼ä¸º `cpp_int`ï¼Œ`half` çš„ç»“æœä¹Ÿæ˜¯ `cpp_int`ã€‚å¯å®é™…ä¸Šï¼Œ`n - 1` çš„ç»“æœè·Ÿä¸Šé¢çš„ Armadillo å±•ç¤ºçš„æƒ…å†µç±»ä¼¼ï¼Œæ˜¯å¦å¤–ä¸€ä¸ªå•ç‹¬çš„ç±»å‹ã€‚æˆ‘éœ€è¦æŠŠ `half(n - 1)` æ”¹å†™æˆ `half(N(n - 1))` æ‰èƒ½å¾—åˆ°æœŸæœ›çš„ç»“æœã€‚

æˆ‘åšçš„è®¡ç®—æŒºç®€å•ï¼Œå¹¶ä¸è§‰å¾—è¡¨è¾¾å¼æ¨¡æ¿å¯¹æˆ‘çš„è®¡ç®—æœ‰å•¥å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘æœ€åæ˜¯ç¦ç”¨äº†è¡¨è¾¾å¼æ¨¡æ¿ï¼š

```
typedef boost::multiprecision::
  number&lt;
    boost::multiprecision::
      cpp_int_backend&lt;&gt;,
    boost::multiprecision::et_off&gt;
    int_type;

```

ç±»ä¼¼äº Armadillo å¯ä»¥æ¢ä¸åŒçš„ BLAS å’Œ LAPACK å®ç°ï¼ŒBoost.Multiprecision ä¹Ÿå¯ä»¥æ”¹æ¢ä¸åŒçš„åç«¯ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ‰“ç®—ä½¿ç”¨ GMP [10] çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦åŒ…å«åˆ©ç”¨ GMP çš„å¤´æ–‡ä»¶ï¼Œå¹¶æŠŠä¸Šé¢çš„ `int_type` çš„å®šä¹‰ä¿®æ­£ä¸€ä¸‹ï¼š

```
#include &lt;boost/multiprecision/gmp.hpp&gt;

typedef boost::multiprecision::
  number&lt;
    boost::multiprecision::gmp_int,
    boost::multiprecision::et_off&gt;
    int_type;

```

æ³¨æ„ï¼Œæˆ‘å¹¶ä¸æ˜¯æ¨èä½ æ¢ç”¨ GMPã€‚å¦‚æœä½ çœŸçš„å¯¹æ€§èƒ½éå¸¸æ¸´æ±‚çš„è¯ï¼Œåº”å½“è¿›è¡Œæµ‹è¯•æ¥é€‰æ‹©åˆé€‚çš„åç«¯ã€‚å¦åˆ™ç¼ºçœçš„åç«¯æ˜“ç”¨æ€§æœ€å¥½â€”â€”æ¯”å¦‚ï¼Œä½¿ç”¨ GMP åç«¯å°±ä¸èƒ½ä½¿ç”¨è‡ªå®šä¹‰å­—é¢é‡äº†ã€‚

æˆ‘å½“æ—¶å¯»æ‰¾é«˜ç²¾åº¦ç®—æœ¯åº“æ˜¯ä¸ºäº†åš RSA åŠ è§£å¯†ã€‚è®¡ç®—æœ¬èº«ä¸å¤æ‚ï¼Œå±äºç¼–ç¨‹å‡ å°æ—¶ã€è¿è¡Œå‡ æ¯«ç§’çš„æƒ…å†µã€‚å¦‚æœä½ æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘é‚£æ—¶çš„æŒ‘é€‰è¿‡ç¨‹å’Œæœ€ç»ˆä»£ç  [11]ã€‚

Boost é‡Œå¥½ä¸œè¥¿å¾ˆå¤šï¼Œè¿œè¿œä¸æ­¢è¿™ä¸€æ ·ã€‚ä¸‹ä¸€è®²æˆ‘ä»¬å°±æ¥ä¸“é—¨èŠèŠ Boostã€‚

## å†…å®¹å°ç»“

æœ¬è®²æˆ‘ä»¬è®¨è®ºäº†ä¸¤ä¸ªè¿›è¡Œè®¡ç®—çš„æ¨¡æ¿åº“ï¼ŒArmadillo å’Œ Boost.Multiprecisionï¼Œå¹¶è®¨è®ºäº†å®ƒä»¬ç”¨åˆ°çš„è¡¨è¾¾å¼æ¨¡æ¿æŠ€å·§å’Œç›¸å…³çš„è®¡ç®—åº“ï¼Œå¦‚ BLASã€LAPACK å’Œ GMPã€‚å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ C++ ä½ å¯ä»¥ç«™åˆ°å·¨äººè‚©ä¸Šï¼Œè½»æ¾å†™å‡ºé«˜æ€§èƒ½çš„è®¡ç®—ä»£ç ã€‚

## è¯¾åæ€è€ƒ

æ€§èƒ½å’Œæ˜“ç”¨æ€§å¾€å¾€æ˜¯æœ‰çŸ›ç›¾çš„ã€‚ä½ å¯¹æ€§èƒ½å’Œæ˜“ç”¨æ€§æœ‰ä»€ä¹ˆæ ·çš„åå¥½å‘¢ï¼Ÿæ¬¢è¿ç•™è¨€ä¸æˆ‘åˆ†äº«ã€‚

## å‚è€ƒèµ„æ–™

[1] Wikipedia, â€œBasic Linear Algebra Subprogramsâ€. [https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms](https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms) 

[2] Wikipedia, â€œLAPACKâ€. [https://en.wikipedia.org/wiki/LAPACK](https://en.wikipedia.org/wiki/LAPACK) 

[3] Wikipedia, â€œARPACKâ€. [https://en.wikipedia.org/wiki/ARPACK](https://en.wikipedia.org/wiki/ARPACK) 

[4] Zhang Xianyi et al., OpenBLAS. [https://github.com/xianyi/OpenBLAS](https://github.com/xianyi/OpenBLAS) 

[5] Intel, Math Kernel Library. [https://software.intel.com/mkl](https://software.intel.com/mkl) 

[6] Ilya Yaroshenko, mir-glas. [https://github.com/libmir/mir-glas](https://github.com/libmir/mir-glas) 

[7] Conrad Sanderson and Ryan Curtin, â€œArmadillo: C++ library for linear algebra &amp; scientific computingâ€. [http://arma.sourceforge.net/](http://arma.sourceforge.net/) 

[8] Wikipedia, â€œExpression templatesâ€. [https://en.wikipedia.org/wiki/Expression_templates](https://en.wikipedia.org/wiki/Expression_templates) 

[9] John Maddock, Boost.Multiprecision. [https://www.boost.org/doc/libs/release/libs/multiprecision/doc/html/index.html](https://www.boost.org/doc/libs/release/libs/multiprecision/doc/html/index.html) 

[10] The GNU MP bignum library. [https://gmplib.org/](https://gmplib.org/) 

[11] å´å’ç‚œ, â€œChoosing a multi-precision library for C++â€”a critiqueâ€. [https://yongweiwu.wordpress.com/2016/06/04/choosing-a-multi-precision-library-for-c-a-critique/](https://yongweiwu.wordpress.com/2016/06/04/choosing-a-multi-precision-library-for-c-a-critique/) 
