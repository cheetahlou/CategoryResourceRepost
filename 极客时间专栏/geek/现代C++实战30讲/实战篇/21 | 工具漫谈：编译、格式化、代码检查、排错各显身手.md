<audio id="audio" title="21 | å·¥å…·æ¼«è°ˆï¼šç¼–è¯‘ã€æ ¼å¼åŒ–ã€ä»£ç æ£€æŸ¥ã€æ’é”™å„æ˜¾èº«æ‰‹" controls="" preload="none"><source id="mp3" src="https://static001.geekbang.org/resource/audio/8a/79/8a343e94eeadf237b0e1158281769a79.mp3"></audio>

ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚

ç°ä»£ C++ è¯­è¨€ï¼Œæˆ‘ä»¬è®²åˆ°è¿™é‡Œå°±å‘Šä¸€æ®µè½äº†ã€‚ä»Šå¤©æˆ‘ä»¬æ­£å¼å¼€å¯äº†å®æˆ˜ç¯‡ï¼Œå…ˆè®²ä¸€ä¸ªè½»æ¾äº›çš„è¯é¢˜â€”â€”å·¥å…·ã€‚

## ç¼–è¯‘å™¨

å½“ç„¶ï¼Œè½»æ¾ä¸ç­‰äºä¸é‡è¦ã€‚æ¯•ç«Ÿï¼Œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚æˆ‘ä»¬åš C++ å¼€å‘ï¼Œæœ€åŸºæœ¬çš„å·¥å…·å°±æ˜¯ç¼–è¯‘å™¨ï¼Œå¯¹å…¶æœ‰äº›äº†è§£æ˜¾ç„¶ä¹Ÿæ˜¯å¿…è¦çš„ã€‚æˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹æˆ‘åœ¨ä¸“æ å¼€å¤´å°±æåˆ°çš„ä¸‰ç§ç¼–è¯‘å™¨ï¼ŒMSVC [1]ã€GCC [2] å’Œ Clang [3]ã€‚

### MSVC

ä¸‰ç§ç¼–è¯‘å™¨é‡Œæœ€è€èµ„æ ¼çš„å°±æ˜¯ MSVC äº†ã€‚æ®å¾®è½¯å‘˜å·¥åœ¨ 2015 å¹´çš„ä¸€ç¯‡åšå®¢ï¼Œåœ¨ MSVC çš„ä»£ç é‡Œè¿˜èƒ½æ‰¾åˆ° 1982 å¹´å†™ä¸‹çš„æ³¨é‡Š [4]ã€‚è¿™æ„å‘³ç€ MSVC æ˜¯æœ€å†å²æ‚ ä¹…ã€æœ€æˆç†Ÿï¼Œä½†ä¹Ÿæ˜¯æœ€æœ‰å†å²åŒ…è¢±çš„ç¼–è¯‘å™¨ã€‚

å¾®è½¯çš„ç¼–è¯‘å™¨åœ¨ä¼ ç»Ÿä»£ç çš„ä¼˜åŒ–æ–¹é¢åšå¾—ä¸€ç›´ä¸é”™ï¼Œä½†å¯¹æ¨¡æ¿çš„æ”¯æŒåˆ™æ˜¯å®ƒçš„è½¯è‚‹ï¼Œåœ¨ Visual Studio 2015 ä¹‹å‰å°¤å…¶ä¸è¡Œâ€”â€”ä¹‹å‰æ¨¡æ¿é—®é¢˜æ•°é‡å·¨å¤§ï¼Œä¹‹åå°±å¥½å¤šäº†ã€‚è€Œ 2018 å¹´ 11 æœˆ MSVC å®£å¸ƒç»ˆäºèƒ½å¤Ÿç¼–è¯‘ range-v3 åº“ï¼Œä¹Ÿæˆäº†ä¸€ä»¶å€¼å¾—åº†è´ºçš„äº‹ [5]ã€‚å½“ç„¶ï¼Œè¿™ä»¶äº‹æƒ…æ˜¯å€¼å¾—é«˜å…´çš„ï¼Œä½†è€ƒè™‘æˆ‘åœ¨ 2016 å¹´çš„æ¼”è®²é‡Œå°±å·²ç»ç”¨åˆ°äº† range-v3ï¼Œä¸èƒ½ä¸è§‰å¾—è¿˜æ˜¯æœ‰ç‚¹æ™šäº†ã€‚æ­¤å¤–ï¼Œæˆ‘å·²ç»æè¿‡ï¼Œå¾®è½¯å¯¹ä»£ç çš„â€œå®¹å¿åº¦â€ä¸€ç›´æœ‰ç‚¹å¤ªé«˜ï¼ˆç¼ºçœæƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨ `/Za` é€‰é¡¹ï¼‰ï¼Œèƒ½æ¥å— C++ æ ‡å‡†è®¤ä¸ºéæ³•çš„ä»£ç ï¼Œè¿™è‡³å°‘å¯¹å†™è·¨å¹³å°çš„ä»£ç è€Œè¨€ï¼Œç»ä¸æ˜¯ä¸€ä»¶å¥½äº‹ã€‚

MSVC å½“ç„¶ä¹Ÿæœ‰é¢†å…ˆçš„åœ°æ–¹ã€‚å®ƒå¯¹æ ‡å‡†åº“çš„å®ç°ä¸€ç›´ä¸ç®—æ…¢ï¼Œè¾ƒæ—©å°±æä¾›äº†æ¯”è¾ƒå¥å£®çš„çº¿ç¨‹ï¼ˆ[[ç¬¬ 19 è®²]](https://time.geekbang.org/column/article/186689)ã€[[ç¬¬ 20 è®²]](https://time.geekbang.org/column/article/186708)ï¼‰ã€æ­£åˆ™è¡¨è¾¾å¼ï¼ˆ[6]ï¼‰ç­‰æ ‡å‡†åº“ã€‚åœ¨å¹¶å‘ [7] æ–¹é¢ï¼Œå¾®è½¯ä¹Ÿæ˜¯æ¯”è¾ƒé¢†å…ˆçš„ï¼Œå¹¶ä¸»å¯¼äº†åç¨‹çš„æŠ€æœ¯è§„æ ¼ä¹¦ [8]ã€‚å¾®è½¯ä¸€å¼€å§‹æ”¯æŒ C++ æ ‡å‡†çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œä½†æ…¢æ…¢åœ°ï¼Œå¾®è½¯å·²ç»æŠŠå…¨é¢æ”¯æŒ C++ æ ‡å‡†å½“ä½œäº†ç›®æ ‡ï¼Œå¹¶åœ¨ 2018 å¹´å®£å¸ƒå·²å…¨é¢æ”¯æŒ C++17 æ ‡å‡†ï¼›è™½ç„¶åŒæ—¶ä¹Ÿæ‰¿è®¤ä»æœ‰ä¸€äº›é‡å¤§é—®é¢˜å½±å“äº†å…¶ç¼–è¯‘ä¸€äº›é‡è¦çš„å¼€æº C++ é¡¹ç›® [9]ã€‚

MSVC æœ‰ä¸€ä¸ªåœ°æ–¹æˆ‘ä¸€ç›´æ¯”è¾ƒå–œæ¬¢ï¼Œå°±æ˜¯ä»£ç é‡Œå¯ä»¥å†™å‡ºè¦æ±‚é“¾æ¥å…·ä½“ä»€ä¹ˆåº“ï¼Œè€Œé“¾æ¥ä»€ä¹ˆåº“çš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¯ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ä»£ç é‡Œç›´æ¥ç»™å‡ºçš„ã€‚è¿™å°±ä½¿å¾—åœ¨å‘½ä»¤è¡Œä¸Šç¼–è¯‘ä½¿ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Boostï¼‰çš„ä»£ç å˜å¾—éå¸¸å®¹æ˜“ã€‚åœ¨ä½¿ç”¨ GCC å’Œ Clang æ—¶ï¼Œç”¨åˆ°ä»€ä¹ˆåº“ï¼Œå°±å¿…é¡»åœ¨å‘½ä»¤è¡Œä¸Šå†™å‡ºæ¥ï¼Œè¿™å°±è¿«ä½¿ç¨‹åºå‘˜ä½¿ç”¨æ›´è§„èŒƒã€ä¹Ÿæ›´éº»çƒ¦çš„ç®¡ç†æ–¹å¼äº†ã€‚å…·ä½“è€Œè¨€ï¼Œå¯¹äºä¸‹é¢çš„è¿™ä¸ªæœ€å°çš„å•å…ƒæµ‹è¯•ç¨‹åºï¼š

```
#define BOOST_TEST_MAIN
#include &lt;boost/test/unit_test.hpp&gt;

BOOST_AUTO_TEST_CASE(minimal_test)
{
  BOOST_CHECK(1 + 1 == 2);
}

```

ä½¿ç”¨ GCC æˆ– Clang æ—¶ä½ éœ€è¦è¾“å…¥ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„å‘½ä»¤ï¼š

> 
`g++ -DBOOST_TEST_DYN_LINK test.cpp -lboost_unit_test_framework`


è€Œ Windows ä¸‹ä½¿ç”¨ MSVC ä½ åªéœ€è¦è¾“å…¥ï¼š

> 
`cl /DBOOST_TEST_DYN_LINK /EHsc /MD test.cpp`


ä¸€ä¸‹å­å°±ç®€å•å¤šäº†ã€‚

å¦å¤–ï¼Œåœ¨å…è´¹çš„ C++ é›†æˆå¼€å‘ç¯å¢ƒé‡Œï¼ŒVisual Studio Community Edition ææ€•å¯ä»¥ç®—æ˜¯æœ€å¥½çš„äº†ï¼Œè‡³å°‘åœ¨ Windows ä¸Šæ˜¯è¿™æ ·ã€‚åœ¨è‡ªåŠ¨å®ŒæˆåŠŸèƒ½å’Œè°ƒè¯•åŠŸèƒ½ä¸Š Visual Studio åšå¾—ç‰¹åˆ«å¥½ï¼Œä¸ºå…¶ä»–çš„å…è´¹å·¥å…·æ‰€ä¸åŠã€‚å¦‚æœä½ å¼€å‘çš„ C++ ç¨‹åºä¸»è¦åœ¨ Windows ä¸Šè¿è¡Œï¼Œé‚£ MSVC å°±åº”è¯¥æ˜¯é¦–é€‰äº†ã€‚

### Clang

ç›¸åï¼Œåœ¨ä¸‰ä¸ªç¼–è¯‘å™¨é‡Œï¼Œæœ€æ–°çš„å°±æ˜¯ Clangã€‚ä½œä¸º LLVM é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçš„æœ€æ—©å‘å¸ƒæ˜¯åœ¨ 2007 å¹´ï¼Œç„¶åæµè¡Œç¨‹åº¦ä¸€è·¯é£™å‡ï¼Œåˆ°ç°åœ¨æˆäº†ä¸€ä¸ªé€šç”¨çš„è·¨å¹³å°ç¼–è¯‘å™¨ã€‚å…¶ä¸­æœ‰ä¸å°‘è‹¹æœçš„æ”¯æŒâ€”â€”å› ä¸ºè‹¹æœå¯¹ GCC çš„è®¸å¯è¦æ±‚ä¸æ»¡æ„ï¼Œè‹¹æœæŠŠ LLVM å¼€å‘è€… Chris Lattner æ‹›è‡´éº¾ä¸‹ï¼ˆ2005â€”2017ï¼‰ï¼ŒæœŸé—´ä»–é™¤äº†ä¸ºè‹¹æœè®¾è®¡å¼€å‘äº†å…¨æ–°çš„è¯­è¨€ Swiftï¼ŒClang çš„ C++ æ”¯æŒä¹Ÿå¾—åˆ°äº†é£é€Ÿçš„å‘å±•ã€‚

ä½œä¸ºåæ¥è€…ï¼ŒClang åœ¨é”™è¯¯ä¿¡æ¯æ˜“ç”¨æ€§ä¸Šåšå‡ºäº†æå¤§çš„æ”¹å–„ã€‚Clang è™½ç„¶ä¸€ç›´åœ¨æ¨¡æ‹Ÿ GCC çš„åŠŸèƒ½å’Œå‘½ä»¤è¡Œï¼Œä½†é”™è¯¯ä¿¡æ¯çš„å‹å¥½æ€§æ˜¯å®ƒçš„æœ€å¤§äº®ç‚¹ã€‚åœ¨è¯­è¨€å±‚é¢ï¼ŒClang å¯¹ C++ æ ‡å‡†çš„æ”¯æŒä¹Ÿæ˜¯é£é€Ÿï¼Œæ­£å¦‚ä¸‹é¢è¿™å¼ å›¾æ‰€å±•ç¤ºçš„é‚£æ ·ï¼ˆ[10]ï¼‰ï¼š

<img src="https://static001.geekbang.org/resource/image/a6/71/a6432b0cbdc5ad6965402800f2057971.png" alt="">

å¯ä»¥çœ‹åˆ°ï¼ŒClang åœ¨ 2011 å¼‚å†›çªèµ·ï¼Œå¯¹ C++11 çš„æ”¯æŒç¨‹åº¦åœ¨çŸ­æ—¶é—´ç”šè‡³è¿˜è¶…è¿‡äº†åŸå…ˆçš„é¢†è·‘è€… GCCã€‚ç”±äº Clang/LLVM çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œåœ¨ Clang ä¸Šæ‰©å±•æ–°åŠŸèƒ½ç›¸å½“å®¹æ˜“ï¼›è€Œä¸”åŠ¨æ€åº“ libclang ç›´æ¥å‘å¼€å‘è€…æš´éœ²äº†åˆ†æ C++ ä»£ç çš„æ¥å£ï¼Œè¿™ä¹Ÿæ˜¯ Clang æµè¡Œçš„ä¸€ä¸ªä¸»è¦åŸå› ã€‚

å³ä½¿åœ¨æˆ‘ä¸»è¦ä½¿ç”¨ Windows å·¥ä½œçš„æ—¶å€™ï¼Œæˆ‘åœ¨æœºå™¨ä¸Šä¹Ÿè£…äº† Clangã€‚æˆ‘ä¸»è¦ä¸æ˜¯ç”¨å®ƒç¼–è¯‘ï¼Œè€Œæ˜¯åˆ©ç”¨å®ƒå¯¹ C++ çš„ç†è§£ï¼Œåšä»£ç çš„æ ¼å¼åŒ–ï¼ˆæœ¬è®²ä¸‹é¢ä¼šè®²ï¼‰å’Œè‡ªåŠ¨å®Œæˆâ€”â€”å¯¹äºæ–‡ä»¶æ•°ä¸å¤šçš„é¡¹ç›®ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢ä½¿ç”¨ Vim [11]ï¼Œé‚£æœºå™¨ä¸Šèƒ½ä¸èƒ½ç”¨ clang_complete [12] åŒºåˆ«å°±å¾ˆå¤§äº†ã€‚æœ‰äº† clang_completeï¼Œé‚£ Vim é‡Œä¹Ÿå°±æœ‰ä¸ªä¸ç®—å¤ªç¬¨çš„ C++ è‡ªåŠ¨å®Œæˆå¼•æ“äº†ã€‚é¡¾åæ€ä¹‰ï¼Œclang_complete ä¸»è¦ä¾èµ–çš„å°±æ˜¯ Clang äº†ï¼Œæ›´ç²¾ç¡®åœ°è¯´ï¼Œæ˜¯ libclangã€‚

å¦å¤–ï¼Œå½“æˆ‘å†™å‡ºåœ¨ MSVC ä¸‹ç¼–è¯‘ä¸è¿‡çš„ä»£ç æ—¶ï¼Œæˆ‘ä¹Ÿä¼šçœ‹çœ‹ä»£ç èƒ½ä¸èƒ½åœ¨ Clang ä¸‹é€šè¿‡ã€‚å¦‚æœèƒ½è¿‡ï¼Œé‚£æˆ‘å°±æ¯”è¾ƒæœ‰ä¿¡å¿ƒï¼Œæˆ‘å†™å‡ºçš„ä»£ç æ˜¯æ­£ç¡®çš„ï¼Œåªä¸è¿‡æ˜¯ MSVC å¤„ç†ä¸äº†è€Œå·²ğŸ˜ˆã€‚

Clang ç›®å‰åœ¨ macOS ä¸‹æ˜¯é»˜è®¤çš„ C/C++ ç¼–è¯‘å™¨ã€‚åœ¨ Linux å’Œ Windows ä¸‹å½“ç„¶ä¹Ÿéƒ½èƒ½å®‰è£…ï¼šè¿™ç§æƒ…å†µä¸‹ï¼ŒClang ä¼šä½¿ç”¨å¹³å°ä¸Šçš„ä¸»æµ C++ åº“ï¼Œä¹Ÿå°±æ˜¯åœ¨ Linux ä¸Šä½¿ç”¨ libstdc++ï¼Œåœ¨ Windows ä¸Šä½¿ç”¨ MSVC çš„ C++ è¿è¡Œæ—¶ã€‚åªæœ‰åœ¨ macOS ä¸Šï¼ŒClang æ‰ä¼šä½¿ç”¨å…¶åŸç”Ÿ C++ åº“ï¼Œlibc++ [13]ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœä½ æƒ³é˜…è¯»ä¸€ä¸‹ç°ä»£ C++ æ ‡å‡†åº“çš„å‚è€ƒå®ç°çš„è¯ï¼Œlibc++ æ˜¯å¯è¯»æ€§æœ€å¥½çš„â€”â€”ä¸è¿‡ï¼Œä»»ä½•ä¸€ä¸ªè½¯ä»¶äº§å“çš„æºä»£ç éƒ½ä¸æ˜¯ä»¥å¯è¯»æ€§ä¸ºç¬¬ä¸€è€ƒé‡ï¼Œæ¯”èµ·æ•™ç§‘ä¹¦ã€ä¸“æ é‡Œçš„ä»£ç ä¾‹å­ï¼Œlibc++ è‚¯å®šæ˜¯è¦å¤æ‚å¤šäº†ã€‚

æœ€åä¸€ä¸ªå…³äºç‰ˆæœ¬å·çš„è¯´æ˜ï¼šè‹¹æœå¼€å‘å·¥å…·é‡Œå¸¦çš„ Clang çš„æ˜¯è‹¹æœè‡ªå·±ç»´æŠ¤çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œç‰ˆæœ¬å·å’Œè‹¹æœçš„ Xcode å¼€å‘å·¥å…·ç‰ˆæœ¬å·ä¸€è‡´ï¼Œå’Œå¼€æºé¡¹ç›® Clang çš„ç‰ˆæœ¬å·æ²¡æœ‰å…³ç³»ï¼Œæ˜¾å¾—æ¯”è¾ƒä¹±ã€‚ç›®å‰ Apple Clang çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 11 äº†ï¼Œä½†åŠŸèƒ½ä¸Šè½åäºå®˜æ–¹çš„ LLVM Clang 9.0 [14]ã€‚è¦æƒ³ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Clangï¼Œæœ€æ–¹ä¾¿çš„æ–¹å¼æ˜¯ä½¿ç”¨ Homebrew [15] å®‰è£… llvmï¼š

> 
`brew install llvm`


å®‰è£…å®Œä¹‹åï¼Œæ–°çš„ clang å’Œ clang++ å·¥å…·åœ¨ /usr/local/opt/llvm/bin ç›®å½•ä¸‹ï¼Œå’Œç³»ç»ŸåŸæœ‰çš„å‘½ä»¤ä¸ä¼šå‘ç”Ÿå†²çªã€‚ä½ å¦‚æœéœ€è¦ä½¿ç”¨æ–°çš„å·¥å…·çš„è¯ï¼Œéœ€è¦æ”¹å˜è·¯å¾„çš„é¡ºåºï¼Œæˆ–è€…è‡ªå·±åˆ›å»ºå‘½ä»¤çš„åˆ«åï¼ˆaliasï¼‰ã€‚

### GCC

GCC çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒäº 1987 å¹´ï¼Œæ˜¯ç”±è‡ªç”±è½¯ä»¶è¿åŠ¨çš„å‘èµ·äºº Richard Stallmanï¼ˆå¸¸å¸¸è¢«ç¼©å†™ä¸º RMSï¼‰äº²è‡ªå†™çš„ã€‚å› è€Œï¼Œä»è¯ç”Ÿä¼Šå§‹ï¼ŒGCC å°±å¸¦ç€å¾ˆå¼ºçš„æ„è¯†å½¢æ€ï¼Œæ‰¿æ‹…ç€æŒ¯å…´è‡ªç”±è½¯ä»¶çš„ä»»åŠ¡ã€‚åœ¨ GNU/Linux å¹³å°ä¸Šï¼ŒGCC è‡ªç„¶æ˜¯é¦–é€‰çš„ç¼–è¯‘å™¨ã€‚è‡ªç”±è½¯ä»¶çš„å¼€å‘è€…ï¼Œå¤§éƒ¨åˆ†ä¹Ÿé€‰æ‹©äº† GCCã€‚ç”±äº GCC æ˜¯ç”¨ GPL å‘å¸ƒçš„ï¼Œä»»ä½•å¯¹ GCC çš„ä¿®æ”¹éƒ½å¿…é¡»ä»¥ GPL åè®®å‘å¸ƒã€‚è¿™å°±è¿«ä½¿æƒ³ä¿®æ”¹ GCC çš„äººè¦ä¸º GCC åšå‡ºè´¡çŒ®ã€‚è¿™å¯¹è‡ªç”±è½¯ä»¶å½“ç„¶æ˜¯ä»¶å¥½äº‹ï¼Œä½†å¯¹ä¸€å®¶å…¬å¸æ¥è®²å°±æœªå¿…äº†ã€‚æ­¤å¤–ï¼Œä½ æƒ³æ‹†å‡º GCC çš„ä¸€éƒ¨åˆ†æ¥åšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚å¯¹ä»£ç è¿›è¡Œåˆ†æï¼Œä¹Ÿç»ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹ã€‚è¿™äº›é—®é¢˜ï¼Œå®é™…ä¸Šå°±æ˜¯è¿«ä½¿è‹¹æœå…¬å¸åœ¨ LLVM/Clang ä¸ŠæŠ•èµ„çš„åŠ¨æœºäº†ã€‚

ä½œä¸ºåº”ç”¨æœ€å¹¿çš„è‡ªç”±è½¯ä»¶ä¹‹ä¸€ï¼ŒGCC æ— ç–‘æ˜¯éå¸¸æˆç†Ÿçš„è½¯ä»¶ã€‚æŸäº›å®éªŒæ€§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¯¹æ¦‚å¿µçš„æ”¯æŒï¼Œä¹Ÿæ˜¯æœ€æ—©åœ¨ GCC ä¸Šé¢å‡ºç°çš„ã€‚å¯¹ C++ æ ‡å‡†çš„æ”¯æŒï¼ŒGCC ä¸€ç›´è·Ÿå¾—éå¸¸ç´§ï¼Œä½†æ˜¯ï¼Œç”±äºè‡ªç”±è½¯ä»¶ä¾é å¿—æ„¿è€…çš„å·¥ä½œï¼Œè€Œéé¡¹ç›®ç»ç†æˆ–äº§å“ç»ç†çš„ç®¡ç†ï¼Œå¯¹ä¸åŒåŠŸèƒ½çš„ä¼˜å…ˆçº§è·Ÿå•†ä¸šäº§å“å¾€å¾€ä¸åŒï¼Œä¹Ÿé€ å°±äº† GCC å’Œ MSVC ä¸Šå„æœ‰ä¸åŒçš„ç€é‡ç‚¹ï¼Œä¼˜åŒ–ç¼–è¯‘ç»“æœå“ªä¸ªæ€§èƒ½æ›´é«˜ä¹Ÿä¼šä¾èµ–äºå…·ä½“çš„ç¨‹åºã€‚å½“ç„¶ GCC æ˜¯è·¨å¹³å°çš„ï¼Œè¿™ç‚¹ä¸Šè‚¯å®šæ˜¯ MSVC ä¸åŠçš„ã€‚æ ¹æ® GCC çš„æ–¹å¼å†™å‡ºçš„ä»£ç ï¼Œè·¨å¹³å°æ€§å°±ä¼šæ›´å¥½ã€‚ç›®å‰æˆ‘å·²çŸ¥çš„æœ€ä¸»è¦ä¾‹å¤–æ˜¯ç»ˆç«¯ä¸Šçš„å¤šè¯­è¨€æ”¯æŒï¼šç”±äº GCC åœ¨ Windows ä¸Šä½¿ç”¨äº† MSVC çš„ä¸€ä¸ªè¿‡æ—¶çš„è¿è¡Œåº“ MSVCRT.DLLï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ GCC è¦åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºä¸­æ–‡ç»å¸¸ä¼šå‡ºç°é—®é¢˜ [16]ã€‚

åˆæœŸ GCC åœ¨å‡ºé”™ä¿¡æ¯çš„å‹å¥½ç¨‹åº¦ä¸Šä¸€ç›´åšå¾—ä¸å¤ªå¥½ã€‚ä½† Clang çš„å‡ºç°åˆºæ¿€å‡ºäº†ä¸€ç§å’Œ GCC ä¹‹é—´çš„è‰¯æ€§ç«äº‰ï¼Œåˆ°ä»Šå¤©ï¼ŒGCC çš„é”™è¯¯ä¿¡æ¯åè€Œæ˜¯æœ€å‹å¥½çš„äº†ã€‚æˆ‘å¦‚æœé‡åˆ°ç¨‹åºç¼–è¯‘å‡ºé”™åœ¨ Clang é‡Œçœ‹ä¸æ˜ç™½çš„è¯ï¼Œæˆ‘ä¼šè¯•ç€ç”¨ GCC å†ç¼–è¯‘çœ‹çœ‹ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ GCC çš„å‡ºé”™ä¿¡æ¯ä¼šæ›´è®©äººæ˜ç™½ä¸€äº›ã€‚

åœ¨å¯é¢„è§çš„å°†æ¥ï¼Œåœ¨è‡ªç”±/å¼€æºè½¯ä»¶çš„å¼€å‘ä¸Šï¼ŒGCC ä¸€ç›´ä¼šæ˜¯ç¼–è¯‘å™¨çš„æ ‡å‡†ã€‚

## æ ¼å¼åŒ–å·¥å…·

### Clang-Format

æˆ‘ä¸Šé¢æåˆ°äº† Clang æœ‰ç€éå¸¸æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œå®¹æ˜“è¢«å…¶ä»–å·¥å…·å¤ç”¨å…¶ä»£ç åˆ†æåŠŸèƒ½ã€‚LLVM å›¢é˜Ÿè‡ªå·±ä¹Ÿæä¾›ä¸€äº›å·¥å…·ï¼Œå…¶ä¸­æˆ‘ä¸ªäººæœ€å¸¸ç”¨çš„å°±æ˜¯ Clang-Format [17]ã€‚

åœ¨ä½¿ç”¨ Clang-Format ä¹‹å‰ï¼Œæˆ‘ä¹Ÿä½¿ç”¨è¿‡ä¸€äº›å…¶ä»–çš„æ ¼å¼åŒ–å·¥å…·ã€‚å®ƒä»¬å’Œ Clang-Format çš„æœ€å¤§åŒºåˆ«æ˜¯ï¼Œå®ƒä»¬ä¸ç†è§£ C++ ä»£ç ï¼Œåœ¨å¯¹ä»˜ç®€å•çš„ C ä»£ç æ—¶è¿˜è¡Œï¼Œé‡åˆ°å¤æ‚çš„ C++ ä»£ç æ—¶å°±å¾ˆå®¹æ˜“å‡ºé—®é¢˜ã€‚æ­¤å¤–ï¼ŒClang-Format è¿˜å¾ˆæ™ºèƒ½ï¼Œå¯ä»¥åƒäººä¸€æ ·ï¼Œæ ¹æ®å…·ä½“æƒ…å†µå’Œå‰©ä½™ç©ºé—´æ¥æ ¼å¼åŒ–ï¼Œæ¯”å¦‚ï¼š

```
void func(int arg1, int arg2,
          int arg3);

void long_func_name(int arg1,
                    int arg2,
                    int arg3);

void a_very_long_func_name(
  int arg1, int arg2, int arg3);

```

æ­¤å¤–ï¼Œå®ƒä¹Ÿæä¾›äº†å®Œå–„çš„é…ç½®é¡¹ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥è¿›è¡Œé…ç½®ï¼Œå¦‚è¿™æ˜¯æˆ‘çš„ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨çš„æ ¼å¼åŒ–é€‰é¡¹ï¼š

[https://github.com/adah1972/nvwa/blob/master/.clang-format](https://github.com/adah1972/nvwa/blob/master/.clang-format)

C++ é¡¹ç›®é‡Œæ”¾ä¸Šè¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼Œä»£ç çš„æ ¼å¼åŒ–é—®é¢˜å¤§å®¶å°±ä¸ç”¨çäº‰äº†â€”â€”å¤§å®¶ç¡®å®šè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å°±è¡Œã€‚

ç›®å‰è¿™ä¸ªä¸“æ çš„ä»£ç æ ¼å¼åŒ–é€‰é¡¹ä¹Ÿå’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œæœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯è¡Œé•¿é™åˆ¶ï¼ˆColumnLimitï¼‰è®¾æˆäº† 36ï¼Œç¼©è¿›å®½åº¦ï¼ˆIndentWidthï¼‰ç­‰é€‰é¡¹åŸºæœ¬å‡åŠï¼Œæ¥é€‚é…æ‰‹æœºçš„å°æ˜¾ç¤ºå±ã€‚å¦‚æœæ²¡æœ‰ Clang-Formatï¼Œåšä»£ç çš„å°å±é€‚é…å°±ä¼šç´¯å¤šäº†ã€‚

## ä»£ç æ£€æŸ¥å·¥å…·

### Clang-Tidy

Clang é¡¹ç›®ä¹Ÿæä¾›äº†å…¶ä»–ä¸€äº›å·¥å…·ï¼ŒåŒ…æ‹¬ä»£ç çš„é™æ€æ£€æŸ¥å·¥å…· Clang-Tidy [18]ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„å·¥å…·ï¼Œå®ƒé™¤äº†ä¼šæç¤ºä½ å±é™©çš„ç”¨æ³•ï¼Œä¹Ÿä¼šå‘Šè¯‰ä½ å¦‚ä½•å»ç°ä»£åŒ–ä½ çš„ä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒClang-Tidy åªåšåŸºæœ¬çš„åˆ†æã€‚ä½ ä¹Ÿå¯ä»¥å‘Šè¯‰å®ƒä½ æƒ³ç°ä»£åŒ–ä½ çš„ä»£ç å’Œæé«˜ä»£ç çš„å¯è¯»æ€§ï¼š

> 
`clang-tidy --checks='clang-analyzer-*,modernize-*,readability-*' test.cpp`


ä»¥ä¸‹é¢ç®€å•ç¨‹åºä¸ºä¾‹ï¼š

```
#include &lt;iostream&gt;
#include &lt;stddef.h&gt;

using namespace std;

int sqr(int x) { return x * x; }

int main()
{
  int a[5] = {1, 2, 3, 4, 5};
  int b[5];
  for (int i = 0; i &lt; 5; ++i) {
    b[i] = sqr(a[i]);
  }
  for (int i : b) {
    cout &lt;&lt; i &lt;&lt; endl;
  }
  char* ptr = NULL;
  *ptr = '\0';
}

```

Clang-Tidy ä¼šæŠ¥å‘Šä¸‹åˆ—é—®é¢˜ï¼š

- &lt;stddef.h&gt; åº”å½“æ›¿æ¢æˆ &lt;cstddef&gt;
- å‡½æ•°å½¢å¼ `int func(â€¦)` åº”å½“ä¿®æ”¹æˆ `auto func(â€¦) -&gt; int`
- ä¸è¦ä½¿ç”¨ C æ•°ç»„ï¼Œåº”å½“æ”¹æˆ `std::array`
- `5` æ˜¯é­”æœ¯æ•°ï¼Œåº”å½“æ”¹æˆå…·åå¸¸æ•°
- `NULL` åº”å½“æ”¹æˆ `nullptr`

å‰ä¸¤æ¡æˆ‘ä¸æƒ³å¬ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶æ¥å®šåˆ¶è¡Œä¸ºå°±å¿…è¦äº†ã€‚é…ç½®æ–‡ä»¶å« .clang-tidyï¼Œåº”å½“æ”¾åœ¨ä½ çš„ä»£ç ç›®å½•ä¸‹æˆ–è€…ä»£ç çš„ä¸€ä¸ªçˆ¶ç›®å½•ä¸‹ã€‚Clang-Tidy ä¼šä½¿ç”¨æœ€â€œè¿‘â€çš„é‚£ä¸ªé…ç½®æ–‡ä»¶ã€‚ä¸‹é¢çš„é…ç½®æ–‡ä»¶åæ˜ äº†æˆ‘çš„åå¥½ï¼š

```
Checks: 'clang-diagnostic-*,clang-analyzer-*,modernize-*,readability-*,-modernize-deprecated-headers,-modernize-use-trailing-return-type'

```

ä¸–ç•Œæ¸…é™å¤šäº†ï¼šæˆ‘ä¸æƒ³å¬åˆ°çš„å”åƒ§å¼çš„å•°å”£å°±æ¶ˆå¤±äº†ã€‚

ä½¿ç”¨ Clang-Tidy è¿˜éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œé¢å¤–çš„å‘½ä»¤è¡Œå‚æ•°åº”å½“è·Ÿåœ¨å‘½ä»¤è¡Œæœ€åçš„ `--` åé¢ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¦æ‰«æä¸€ä¸ª C++ å¤´æ–‡ä»¶ foo.hï¼Œæˆ‘ä»¬å°±éœ€è¦æ˜ç¡®å‘Šè¯‰ Clang-Tidy è¿™æ˜¯ C++ æ–‡ä»¶ï¼ˆé»˜è®¤ .h æ˜¯ C æ–‡ä»¶ï¼‰ã€‚ç„¶åï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åŒ…å«çˆ¶ç›®å½•ä¸‹çš„ common ç›®å½•ï¼Œè¯­è¨€æ ‡å‡†ä½¿ç”¨äº† C++17ï¼Œå‘½ä»¤è¡Œå°±åº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š

> 
`clang-tidy foo.h -- -x c++ -std=c++17 -I../common`


ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œä¸Šé¢ Clang-Tidy å®é™…ä¸Šæ¼æŠ¥å‘Šäº†äº›é—®é¢˜ï¼šå®ƒæŠ¥å‘Šäº†ä¸€äº›ä¸é‡è¦çš„é—®é¢˜ï¼Œå´æ¼è¿‡äº†çœŸæ­£ä¸¥é‡çš„é—®é¢˜ã€‚è¿™ä¼¼ä¹æ˜¯ä¸ªå®ç°ç›¸å…³çš„ç‰¹æ®Šé—®é¢˜ï¼Œå› ä¸ºå¦‚æœæŠŠå‰é¢é‚£äº›è¡Œåˆ æ‰çš„è¯ï¼Œåé¢ä¸¤è¡Œæœ‰é—®é¢˜çš„ä»£ç ä¹Ÿè¿˜æ˜¯ä¼šäº§ç”Ÿå‘Šè­¦çš„ã€‚

### Cppcheck

Clang-Tidy è¿˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒâ€œé‡â€çš„å·¥å…·ã€‚å®ƒéœ€è¦æœ‰ä¸€å®šçš„é…ç½®ï¼Œéœ€è¦èƒ½çœ‹åˆ°æ–‡ä»¶ç”¨åˆ°çš„å¤´æ–‡ä»¶ï¼Œè¿è¡Œçš„æ—¶é—´ä¹Ÿä¼šè¾ƒé•¿ã€‚è€Œ Cppcheck [19] å°±æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çš„å·¥å…·äº†ã€‚å®ƒè¿è¡Œé€Ÿåº¦é£å¿«ï¼Œçœ‹ä¸åˆ°å¤´æ–‡ä»¶ã€ä¸éœ€è¦é…ç½®å°±èƒ½ä½¿ç”¨ã€‚å®ƒè·Ÿ Clang-Tidy çš„é‡ç‚¹ä¹Ÿä¸å¤ªä¸€æ ·ï¼šå®ƒå¼ºè°ƒçš„æ˜¯å‘ç°ä»£ç å¯èƒ½å‡ºé—®é¢˜çš„åœ°æ–¹ï¼Œè€Œä¸å¤ªç€é‡ä»£ç é£æ ¼é—®é¢˜ï¼Œä¸¤è€…åŠŸèƒ½å¹¶ä¸å®Œå…¨é‡å ã€‚æœ‰æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªå·¥å…·å¯ä»¥ä¸€èµ·ä½¿ç”¨ã€‚

ä»¥ä¸Šé¢çš„ä¾‹å­æ¥ä¸ºä¾‹ï¼ŒCppcheck ä¼šå¹²è„†åœ°æŠ¥å‘Šä»£ç ä¸­æœ€ä¸¥é‡çš„é—®é¢˜â€”â€”ç©ºæŒ‡é’ˆçš„è§£å¼•ç”¨ã€‚å®ƒçš„å¼€é”€å¾ˆä½ï¼Œå´èƒ½å‘ç°æ½œåœ¨çš„å®‰å…¨æ€§é—®é¢˜ï¼Œå› è€Œæˆ‘è§‰å¾—è¿™æ˜¯ä¸ªæ€§ä»·æ¯”å¾ˆé«˜çš„å·¥å…·ã€‚

## æ’é”™å·¥å…·

æ’é”™å·¥å…·å½“ç„¶ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬ä»Šå¤©ä»‹ç»å…¶ä¸­ä¸¤ä¸ªï¼ŒValgrind å’Œ nvwa::debug_newã€‚

### Valgrind

Valgrind [20] ç®—æ˜¯ä¸€ä¸ªè€ç‰Œå·¥å…·äº†ã€‚å®ƒæ˜¯ä¸€ä¸ªéä¾µå…¥å¼çš„æ’é”™å·¥å…·ã€‚æ ¹æ® Valgrind çš„æ–‡æ¡£ï¼Œå®ƒä¼šå¯¼è‡´å¯æ‰§è¡Œæ–‡ä»¶çš„é€Ÿåº¦å‡æ…¢ 20 è‡³ 30 å€ã€‚ä½†å®ƒå¯ä»¥åœ¨ä¸æ”¹å˜å¯æ‰§è¡Œæ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œåªè¦æ±‚ä½ åœ¨ç¼–è¯‘æ—¶å¢åŠ äº§ç”Ÿè°ƒè¯•ä¿¡æ¯çš„å‘½ä»¤è¡Œå‚æ•°ï¼ˆ`-g`ï¼‰ï¼Œå³å¯æŸ¥å‡ºå†…å­˜ç›¸å…³çš„é”™è¯¯ã€‚

ä»¥ä¸‹é¢çš„ç®€å•ç¨‹åºä¸ºä¾‹ï¼š

```
int main()
{
  char* ptr = new char[20];
}

```

åœ¨ Linux ä¸Šä½¿ç”¨ `g++ -g test.cpp`  ç¼–è¯‘ä¹‹åï¼Œç„¶åä½¿ç”¨ `valgrind --leak-check=full ./a.out` æ£€æŸ¥è¿è¡Œç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°çš„è¾“å‡ºä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="https://static001.geekbang.org/resource/image/5c/50/5cb2060de012f04c4b30741c6e0deb50.png" alt="">

å³å…¶ä¸­åŒ…å«äº†å†…å­˜æ³„æ¼çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å†…å­˜æ˜¯ä»ä»€ä¹ˆåœ°æ–¹æ³„æ¼çš„ã€‚

Valgrind çš„åŠŸèƒ½å¹¶ä¸åªæ˜¯å†…å­˜æŸ¥é”™ï¼Œä¹ŸåŒ…å«äº†å¤šçº¿ç¨‹é—®é¢˜åˆ†æç­‰å…¶ä»–åŠŸèƒ½ã€‚è¦è¿›ä¸€æ­¥äº†è§£ç›¸å…³ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…å…¶æ–‡æ¡£ã€‚

### nvwa::debug_new

åœ¨ nvwa [21] é¡¹ç›®é‡Œï¼Œæˆ‘ä¹ŸåŒ…å«äº†ä¸€ä¸ªå¾ˆå°çš„å†…å­˜æ³„æ¼æ£€æŸ¥å·¥å…·ã€‚å®ƒçš„æœ€å¤§ä¼˜ç‚¹æ˜¯å°å·§ï¼Œå¹¶ä¸”å¯¹ç¨‹åºè¿è¡Œæ€§èƒ½å½±å“æå°ï¼›ç¼ºç‚¹ä¸»è¦æ˜¯ä¸åŠ Valgrind æ˜“ç”¨å’Œå¼ºå¤§ï¼Œåªèƒ½æ£€æŸ¥ `new` å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œå¹¶éœ€è¦ä¾µå…¥å¼åœ°å¯¹é¡¹ç›®åšä¿®æ”¹ã€‚

éœ€è¦æ£€æµ‹å†…å­˜æ³„æ¼æ—¶ï¼Œä½ éœ€è¦æŠŠ debug_new.cpp åŠ å…¥åˆ°é¡¹ç›®é‡Œã€‚æ¯”å¦‚ï¼Œå¯ä»¥ç®€å•åœ°åœ¨å‘½ä»¤è¡Œä¸ŠåŠ å…¥è¿™ä¸ªæ–‡ä»¶ï¼š

> 
<p>`c++ test.cpp \`<br>
`../nvwa/nvwa/debug_new.cpp`</p>


ä¸‹é¢æ˜¯å¯èƒ½çš„è¿è¡Œæ—¶æŠ¥é”™ï¼š

> 
<p>`Leaked object at 0x100302760 (size 20, 0x1000018a4)`<br>
`*** 1 leaks found`</p>


åœ¨ä½¿ç”¨ GCC å’Œ Clang æ—¶ï¼Œå¯ä»¥è®©å®ƒè‡ªåŠ¨å¸®ä½ æ‰¾å‡ºå†…å­˜æ³„æ¼ç‚¹çš„ä½ç½®ã€‚åœ¨å‘½ä»¤è¡Œä¸Šéœ€è¦åŠ å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ï¼Œå¹¶äº§ç”Ÿè°ƒè¯•ä¿¡æ¯ï¼š

> 
<p>`c++ -D_DEBUG_NEW_PROGNAME=\"a.out\" \`<br>
`-g test.cpp \`<br>
`../nvwa/nvwa/debug_new.cpp`</p>


è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿è¡Œæ—¶çœ‹åˆ°ä¸€ä¸ªæ›´æ˜ç¡®çš„é”™è¯¯ï¼š

> 
<p>`Leaked object at 0x100302760 (size 20, main (in a.out) (test.cpp:3))`<br>
`*** 1 leaks found`</p>


è¿™ä¸ªå·¥å…·çš„å…¶ä»–ç”¨æ³•å¯ä»¥å‚è§æ–‡æ¡£ã€‚

## ç½‘é¡µå·¥å…·

### Compiler Explorer

ç¼–è¯‘å™¨éƒ½æœ‰è¾“å‡ºæ±‡ç¼–ä»£ç çš„åŠŸèƒ½ï¼šåœ¨ MSVC ä¸Šå¯ä½¿ç”¨ `/Fa`ï¼Œåœ¨ GCC å’Œ Clang ä¸Šå¯ä½¿ç”¨ `-S`ã€‚ä¸è¿‡ï¼Œè¦æŠŠæºä»£ç å’Œæ±‡ç¼–å¯¹åº”èµ·æ¥ï¼Œå°±éœ€è¦ä¸€å®šçš„åŠŸåŠ›äº†ã€‚åœ¨è¿™ç‚¹ä¸Šï¼Œgodbolt.org [22] å¯ä»¥æä¾›å¾ˆå¤§çš„å¸®åŠ©ã€‚å®ƒé…ç½®äº†å¤šä¸ªä¸åŒçš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥è¿‡æ»¤æ‰ç¼–è¯‘å™¨äº§ç”Ÿçš„æ±‡ç¼–ä¸­å¼€å‘è€…ä¸€èˆ¬ä¸å…³å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶èƒ½å¤Ÿä½¿ç”¨é¢œè‰²å’Œæç¤ºæ¥å¸®åŠ©ä½ å…³è”æºä»£ç å’Œäº§ç”Ÿçš„æ±‡ç¼–ã€‚ä½¿ç”¨è¿™ä¸ªç½‘ç«™ï¼Œä½ ä¸ä»…å¯ä»¥å¿«é€ŸæŸ¥çœ‹ä½ çš„ä»£ç åœ¨ä¸åŒç¼–è¯‘å™¨é‡Œçš„ä¼˜åŒ–ç»“æœï¼Œè¿˜èƒ½å¿«é€Ÿåˆ†äº«ç»“æœã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸ªé“¾æ¥ï¼Œå°±å¯ä»¥å±•ç¤ºæˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„ä¸€ä¸ªæ¨¡æ¿å…ƒç¼–ç¨‹ä»£ç çš„ç¼–è¯‘ç»“æœï¼š

[https://godbolt.org/z/zPNEJ4](https://godbolt.org/z/zPNEJ4)

ç½‘é¡µæˆªå›¾ç¤ºæ„å¦‚ä¸‹ï¼š

<img src="https://static001.geekbang.org/resource/image/e1/a2/e1f3f1f2125c6b0679fbf0752d30cda2.jpg" alt="">

å½“ç„¶ï¼Œä½œä¸ºä¸€ä¸ªç½‘ç«™ï¼Œgodbolt.org å¯¹ä»£ç çš„å¤æ‚åº¦æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œä¹Ÿä¸èƒ½ä»»æ„ä½¿ç”¨ä½ åœ¨ä»£ç é‡Œç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆä¸è¿‡ï¼Œå®ƒå·²ç»è£…äº†ä¸å°‘ä¸»æµçš„ C++ åº“ï¼Œå¦‚æˆ‘ä»¬åé¢ä¼šè®²åˆ°çš„ Boostã€Catch2ã€range-v3 å’Œ cppcoroï¼‰ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥åœ¨ä½ è‡ªå·±çš„æœºå™¨ä¸Šæœ¬åœ°å®‰è£…å®ƒèƒŒåçš„å¼•æ“ï¼Œcompiler-explorer [23]ã€‚å¦‚æœä½ çš„ä»£ç è¾ƒå¤æ‚ï¼Œæˆ–è€…æœ‰å®‰å…¨ã€éšç§æ–¹é¢çš„é¡¾è™‘çš„è¯ï¼Œå¯ä»¥è€ƒè™‘è¿™ä¸ªæ–¹æ¡ˆã€‚

### C++ Insights

å¦‚æœä½ åœ¨ä¸Šé¢çš„é“¾æ¥é‡Œç‚¹å‡»äº†â€œCppInsightsâ€æŒ‰é’®çš„è¯ï¼Œä½ å°±ä¼šè·³è½¬åˆ° C++ Insights [24] ç½‘ç«™ï¼Œå¹¶ä¸”ä½ è´´åœ¨ godbolt.org çš„ä»£ç ä¹Ÿä¼šä¸€èµ·è¢«å¸¦è¿‡å»ã€‚è¿™ä¸ªç½‘ç«™æä¾›äº†å¦å¤–ä¸€ä¸ªç¼–è¯‘å™¨ç›®å‰æ²¡æœ‰æä¾›ã€ä½†ååˆ†æœ‰ç”¨çš„åŠŸèƒ½ï¼šå±•ç¤ºæ¨¡æ¿çš„å±•å¼€è¿‡ç¨‹ã€‚

å›æƒ³æˆ‘ä»¬åœ¨æ¨¡æ¿ç¼–ç¨‹æ—¶çš„ç—›è‹¦ä¹‹ä¸€æ¥è‡ªäºæˆ‘ä»¬éœ€è¦åœ¨è„‘å­ä¸­æƒ³è±¡æ¨¡æ¿æ˜¯å¦‚ä½•å±•å¼€çš„ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹éå¸¸å®¹æ˜“å‡ºé”™ã€‚å½“ç¼–è¯‘å™¨å‡ºé”™æ—¶ï¼Œæˆ‘ä»¬å¾—é€šè¿‡å†—é•¿çš„é”™è¯¯ä¿¡æ¯æ¥å¯»æ‰¾å‡ºé”™åŸå› çš„è››ä¸é©¬è¿¹ï¼›å½“ç¼–è¯‘å™¨æˆåŠŸç¼–è¯‘äº†ä¸€æ®µæˆ‘ä»¬ä¸é‚£ä¹ˆç†è§£çš„æ¨¡æ¿ä»£ç æ—¶ï¼Œæˆ‘ä»¬åœ¨æ„Ÿåˆ°åº†å¹¸çš„åŒæ—¶ï¼Œä¹Ÿå¾€å¾€ä¼šä»ç„¶å¾ˆå›°æƒ‘â€”â€”è€Œä½¿ç”¨è¿™ä¸ªç½‘ç«™ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ­£ç¡®å·¥ä½œçš„æ¨¡æ¿æ˜¯å¦‚ä½•å±•å¼€çš„ã€‚ä»¥[[ç¬¬ 18 è®²]](https://time.geekbang.org/column/article/185899) è®¨è®ºçš„ `make_index_sequence` ä¸ºä¾‹ï¼Œå¦‚æœä½ æŠŠä»£ç å®Œæ•´è¾“å…¥åˆ°ç½‘ç«™ä¸Šå»ã€ç„¶åå°è¯•å±•å¼€ `make_index_sequence&lt;5&gt;`ï¼Œä½ å°±ä¼šçœ‹åˆ° `index_sequence_helper` æ˜¯è¿™æ ·å±•å¼€çš„ï¼š

> 
<p>`index_sequence_helper&lt;5&gt;`<br>
`index_sequence_helper&lt;4, 4&gt;`<br>
`index_sequence_helper&lt;3, 3, 4&gt;`<br>
`index_sequence_helper&lt;2, 2, 3, 4&gt;`<br>
`index_sequence_helper&lt;1, 1, 2, 3, 4&gt;`<br>
`index_sequence_helper&lt;0, 0, 1, 2, 3, 4&gt;`</p>


å¦‚æœæˆ‘æ›´æ—©ä¸€ç‚¹çŸ¥é“è¿™ä¸ªå·¥å…·çš„è¯ï¼Œæˆ‘å°±ä¼šåœ¨è®²ç¼–è¯‘æœŸç¼–ç¨‹çš„æ—¶å€™ç›´æ¥å»ºè®®å¤§å®¶ç”¨äº†ï¼Œåº”è¯¥ä¼šæ›´æœ‰åŠ©äºæ¨¡æ¿çš„ç†è§£â€¦â€¦

## å†…å®¹å°ç»“

åœ¨ä»Šå¤©è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å¯¹å„ä¸ªç¼–è¯‘å™¨å’Œä¸€äº›å¸¸ç”¨çš„å·¥å…·ä½œäº†ç®€å•çš„ä»‹ç»ã€‚ç”¨å¥½å·¥å…·ï¼Œå¯ä»¥å¤§å¤§æå‡ä½ çš„å¼€å‘æ•ˆç‡ã€‚

## è¯¾åæ€è€ƒ

å“ªäº›å·¥å…·ä½ è§‰å¾—æ¯”è¾ƒæœ‰ç”¨ï¼Ÿå“ªäº›å·¥å…·ä½ å·²ç»åœ¨ç”¨äº†ï¼ˆé™¤äº†ç¼–è¯‘å™¨ï¼‰ï¼Ÿä½ ä¸ªäººè¿˜ä¼šæ¨èå“ªäº›å·¥å…·ï¼Ÿ

æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ã€‚

## å‚è€ƒèµ„æ–™

[1] Visual Studio. [https://visualstudio.microsoft.com/](https://visualstudio.microsoft.com/) 

[2] GCC, the GNU Compiler Collection. [https://gcc.gnu.org/](https://gcc.gnu.org/) 

[3] Clang: a C language family frontend for LLVM. [https://clang.llvm.org/](https://clang.llvm.org/) 

[4] Jim Springfield,  â€œRejuvenating the Microsoft C/C++ compilerâ€. [https://devblogs.microsoft.com/cppblog/rejuvenating-the-microsoft-cc-compiler/](https://devblogs.microsoft.com/cppblog/rejuvenating-the-microsoft-cc-compiler/) 

[5] Casey Carter, â€œUse the official range-v3 with MSVC 2017 version 15.9â€. [https://devblogs.microsoft.com/cppblog/use-the-official-range-v3-with-msvc-2017-version-15-9/](https://devblogs.microsoft.com/cppblog/use-the-official-range-v3-with-msvc-2017-version-15-9/) 

[6] cppreference.com, â€œstd::regexâ€. [https://en.cppreference.com/w/cpp/regex/basic_regex](https://en.cppreference.com/w/cpp/regex/basic_regex) 

[7] Microsoft, â€œConcurrency Runtimeâ€. [https://docs.microsoft.com/en-us/cpp/parallel/concrt/concurrency-runtime](https://docs.microsoft.com/en-us/cpp/parallel/concrt/concurrency-runtime) 

[8] ISO/IEC JTC1 SC22 WG21, â€œProgramming languagesâ€”C++extensions for coroutinesâ€. [http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4680.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/n4680.pdf) 

[9] Ulzii Luvsanbat, â€œAnnouncing: MSVC conforms to the C++ standardâ€. [https://devblogs.microsoft.com/cppblog/announcing-msvc-conforms-to-the-c-standard/](https://devblogs.microsoft.com/cppblog/announcing-msvc-conforms-to-the-c-standard/) 

[10] Jonathan Adamczewski, â€œThe growth of modern C++ supportâ€. [http://brnz.org/hbr/?p=1404](http://brnz.org/hbr/?p=1404) 

[11] Vim Online. [https://www.vim.org/](https://www.vim.org/) 

[12] Xavier Deguillard, clang_complete. [https://github.com/xavierd/clang_complete](https://github.com/xavierd/clang_complete) 

[13] â€œlibc++â€ C++ Standard Library . [https://libcxx.llvm.org/](https://libcxx.llvm.org/) 

[14] cppreference.com, â€œC++ compiler supportâ€. [https://en.cppreference.com/w/cpp/compiler_support](https://en.cppreference.com/w/cpp/compiler_support) 

[15] Homebrew. [https://brew.sh/](https://brew.sh/) 

[16] å´å’ç‚œ, â€œMSVCRT.DLL console I/O bugâ€. [https://yongweiwu.wordpress.com/2016/05/27/msvcrt-dll-console-io-bug/](https://yongweiwu.wordpress.com/2016/05/27/msvcrt-dll-console-io-bug/) 

[17] ClangFormat. [https://clang.llvm.org/docs/ClangFormat.html](https://clang.llvm.org/docs/ClangFormat.html) 

[18] Clang-Tidy. [https://clang.llvm.org/extra/clang-tidy/](https://clang.llvm.org/extra/clang-tidy/) 

[19] Daniel MarjamÃ¤ki, Cppcheck. [https://github.com/danmar/cppcheck](https://github.com/danmar/cppcheck) 

[20] Valgrind Home. [https://valgrind.org/](https://valgrind.org/) 

[21] å´å’ç‚œ, nvwa. [https://github.com/adah1972/nvwa/](https://github.com/adah1972/nvwa/) 

[22] Matt Godbolt, â€œCompiler Explorerâ€. [https://godbolt.org/](https://godbolt.org/) 

[23] Matt Godbolt, compiler-explorer. [https://github.com/mattgodbolt/compiler-explorer](https://github.com/mattgodbolt/compiler-explorer) 

[24] Andreas Fertig, â€œC++ Insightsâ€. [https://cppinsights.io/](https://cppinsights.io/) 
